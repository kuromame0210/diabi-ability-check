# アビリティチェックシステム 詳細仕様書（2問版）

## 1. システム概要
- 小学校1-3年生向け認知能力測定システム
- 2問構成 + 結果表示の3ページ構成
- 各問題30秒の時間制限
- 1問1点の得点システム

## 2. 問題詳細仕様

### 2.1 問題1: 線つなぎ問題（視覚的追跡）

#### 問題内容
- **指示文**: 「きごうから　めだけでせんをたどったさきのすうじをせんたくしてください」
- **画像**: あみだくじ形式の線つなぎ
  - 上部: 星（★）、ハート（♥）、三角（▲）の3つの記号
  - 下部: 数字 1, 2, 3
  - 中間: 複雑に交差する線

#### 正解
- 星（★） → 2
- ハート（♥） → 1
- 三角（▲） → 3

#### UI仕様
- 画像表示エリア
- 入力エリア:
  - 星の答え: [ ] (数字入力フィールド)
  - ハートの答え: [ ] (数字入力フィールド)
  - 三角の答え: [ ] (数字入力フィールド)
- 「かいとうする」ボタン
- タイマー表示（30秒カウントダウン）

#### 採点方式
- 3つ全て正解: 2.5点
- 2つ正解: 1点
- 1つ以下正解: 0点

### 2.2 問題2: 数字欠け問題（視覚的認知）

#### 問題内容
- **指示文**: 「０から９までの数字がならんでいます。ひとつだけ足りない数字を答えてください」
- **注意書き**: 「※指で数字をなぞらず目だけで見つけてください。」
- **問題数**: 5問連続

#### 問題パターン（配列で管理）
```javascript
const problem2Patterns = [
  { numbers: [0,1,2,3,4,6,7,8,9], answer: 5 },
  { numbers: [0,1,3,4,5,6,7,8,9], answer: 2 },
  { numbers: [1,2,3,4,5,6,7,8,9], answer: 0 },
  { numbers: [0,1,2,3,4,5,6,8,9], answer: 7 },
  { numbers: [0,1,2,3,5,6,7,8,9], answer: 4 }
];
```

#### UI仕様
- 数字表示エリア（枠線で囲む）
- 入力エリア: 「答え: [ ] (数字入力フィールド)」
- 「かいとうする」ボタン
- タイマー表示（30秒カウントダウン）

#### 採点方式
- 5問全て正解: 2.5点
- 3問正解: 1点
- 2問以下正解: 0点

## 3. ページ構成

### 3.1 ページフロー
1. **名前入力ページ** → 2. **問題1ページ** → 3. **問題2ページ（5問連続）** → 4. **結果ページ**

### 3.2 各ページ仕様

#### 名前入力ページ
- 「なまえをいれてください（漢字で入力）」
- 名前入力フィールド（漢字入力）
- 実施日時の自動取得
- 「はじめる」ボタン

#### 問題ページ（共通要素）
- 上部: タイマー表示「のこり: XX秒」
- 中央: 問題内容
- 下部: 「かいとうする」または「つぎへ」ボタン
- 時間切れ時: 自動で次のページへ遷移

#### 結果ページ
- 名前表示
- 得点表示「X/5点」（最大5点: 問題1で2.5点 + 問題2で2.5点）
- **レーダーチャート表示**（4つのアビリティ）
  - 読解
  - 集中・注意
  - 記憶
  - 認知
- **アビリティ分析表示**
  - 得意なアビリティ: 「○○○が得意です！」
  - 苦手なアビリティ: 「○○○をもっと伸ばしましょう」
- 各問題の正解/不正解表示
- **CSVエクスポート機能**
  - 「データをダウンロード」ボタン
  - CSV形式でユーザーデータを出力
- 「おわり」ボタン

## 4. 技術仕様

### 4.1 タイマー機能
- 各問題30秒の制限時間
- 1秒ごとにカウントダウン表示更新
- 時間切れ時の自動遷移

### 4.2 データ構造
```javascript
// ユーザーデータ（ステート管理）
const userData = {
  name: "田中太郎",              // 漢字で入力
  testDate: "2025-01-15",       // 実施日（YYYY-MM-DD形式）
  testTime: "14:30:25",         // 実施時刻（HH:MM:SS形式）
  answers: {
    problem1: { star: 2, heart: 1, triangle: 3 },
    problem2: [5, 2, 0, 7, 4] // 5問分の回答
  },
  scores: {
    problem1: 2.5, // 3問全て正解
    problem2: 1, // 5問中3問正解
    total: 3.5
  },
  abilities: {
    reading: 3.5,      // 読解
    attention: 2.8,    // 集中・注意
    memory: 4.1,       // 記憶
    cognition: 3.2     // 認知
  },
  timestamps: {
    start: "2025-01-15T14:30:25",
    problem1: "2025-01-15T14:30:55",
    problem2: "2025-01-15T14:31:25",
    end: "2025-01-15T14:31:55"
  }
};
```

### 4.3 問題データ管理
```javascript
// 問題1の画像パス
const problem1Image = "./docs/アビリティチェックもんだい１.png";

// 問題1の正解
const problem1Answer = { star: 2, heart: 1, triangle: 3 };

// 問題2のパターン配列（5問分）
const problem2Patterns = [
  { numbers: [0,1,2,3,4,6,7,8,9], answer: 5 },
  { numbers: [0,1,3,4,5,6,7,8,9], answer: 2 },
  { numbers: [1,2,3,4,5,6,7,8,9], answer: 0 },
  { numbers: [0,1,2,3,4,5,6,8,9], answer: 7 },
  { numbers: [0,1,2,3,5,6,7,8,9], answer: 4 }
];
```

## 5. UI/UX要件

### 5.1 デザイン方針
- 子供向けの大きなフォントとボタン
- 明るい色使い
- 直感的な操作

### 5.2 レスポンシブ対応
- タブレット表示最適化
- タッチ操作対応

## 6. 確認事項・質問

### 6.1 実装方針について
1. **問題1の画像**: 既存画像を使用するか、SVGで再作成するか？
2. **問題2のパターン**: 何パターン用意するか？
3. **結果表示**: シンプルなテキスト表示で良いか？
4. **データ保存**: 今回は実装せず、後で追加で良いか？

### 6.2 技術選択
**最終決定技術スタック:**
- **フロントエンド**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **レーダーチャート**: Chart.js
- **データ保存**: Google Sheets API
- **デプロイ**: Vercel

**API構成:**
- Next.js API Routes で Google Sheets API 呼び出し
- 環境変数で API キー管理
- サーバーサイドでセキュアな API 実行

**実装方針:**
- レスポンシブデザイン対応
- 子供向けの直感的UI
- 高速でスケーラブルな構成

## 7. レーダーチャート仕様

### 7.1 表示項目
4つのアビリティを5段階（0-5点）で評価：
- **読解**: 文章理解・言語処理能力
- **集中・注意**: 持続的注意力・選択的注意力
- **記憶**: 作業記憶・短期記憶能力
- **認知**: 視覚認知・空間認知能力

### 7.2 ダミーデータ生成方式
2問の結果から4つのアビリティスコアを算出（仮の計算式）：
```javascript
// 仮の計算ロジック（実際の対応は後で調整）
function calculateAbilities(problem1Score, problem2Score) {
  return {
    reading: (problem1Score * 0.6 + problem2Score * 0.4) + Math.random() * 0.5,
    attention: (problem2Score * 0.8 + problem1Score * 0.2) + Math.random() * 0.5,
    memory: (problem1Score * 0.4 + problem2Score * 0.6) + Math.random() * 0.5,
    cognition: (problem1Score * 0.8 + problem2Score * 0.2) + Math.random() * 0.5
  };
}
```

### 7.3 レーダーチャート実装方針
**採用決定: Chart.js を使用**
- 軽量で実装が簡単
- 子供向けの見やすいデザインに調整可能
- レスポンシブ対応
- アニメーション効果付与可能

**Chart.js設定:**
```html
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
```

### 7.4 アビリティ分析機能
レーダーチャートの結果から自動分析：
```javascript
// アビリティ分析ロジック
function analyzeAbilities(abilities) {
  const abilityNames = {
    reading: '読解',
    attention: '集中・注意',
    memory: '記憶',
    cognition: '認知'
  };

  // 最高得点と最低得点のアビリティを特定
  const scores = Object.entries(abilities);
  const strongest = scores.reduce((a, b) => a[1] > b[1] ? a : b);
  const weakest = scores.reduce((a, b) => a[1] < b[1] ? a : b);

  return {
    strongest: `${abilityNames[strongest[0]]}が得意です！`,
    weakest: `${abilityNames[weakest[0]]}をもっと伸ばしましょう`
  };
}
```

### 7.5 表示レイアウト
結果ページのレイアウト構成：
1. 上部: 名前・総得点
2. 中央: レーダーチャート
3. 下部: アビリティ分析（得意・苦手）
4. 最下部: 問題別結果・完了ボタン

## 8. データ保存・エクスポート機能

### 8.1 データ保存方式
**採用決定: Google Sheets API連携**
- Google Sheets APIを使用してスプレッドシートに直接書き込み
- リアルタイムでデータ蓄積・一元管理
- 複数ユーザーのデータを統合して分析可能
- スプレッドシートで直接データ確認・集計が可能

### 8.2 CSV出力仕様
```javascript
// CSV出力データ形式
const csvHeaders = [
  "名前", "実施日", "実施時刻",
  "問題1得点", "問題2得点", "総得点",
  "読解", "集中・注意", "記憶", "認知",
  "得意分野", "苦手分野"
];

// CSV生成例
function generateCSV(userData) {
  const analysis = analyzeAbilities(userData.abilities);
  return [
    userData.name,
    userData.testDate,
    userData.testTime,
    userData.scores.problem1,
    userData.scores.problem2,
    userData.scores.total,
    userData.abilities.reading,
    userData.abilities.attention,
    userData.abilities.memory,
    userData.abilities.cognition,
    analysis.strongest,
    analysis.weakest
  ].join(',');
}
```

### 8.3 個人特定機能
- **名前**: 漢字入力（重複可能）
- **実施日時**: 自動取得で一意性確保
- **識別子**: `名前_YYYY-MM-DD_HH-MM-SS` 形式

### 8.4 Google Sheets API実装仕様（Next.js）

**API Route: `/api/save-data`**
```typescript
// pages/api/save-data.ts (または app/api/save-data/route.ts)
import { NextApiRequest, NextApiResponse } from 'next';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== 'POST') {
    return res.status(405).json({ message: 'Method not allowed' });
  }

  const { userData } = req.body;

  try {
    const response = await fetch(
      `https://sheets.googleapis.com/v4/spreadsheets/${process.env.GOOGLE_SHEET_ID}/values/Sheet1!A:L:append?valueInputOption=RAW&key=${process.env.GOOGLE_API_KEY}`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          values: [[
            userData.name,
            userData.testDate,
            userData.testTime,
            userData.scores.problem1,
            userData.scores.problem2,
            userData.scores.total,
            userData.abilities.reading,
            userData.abilities.attention,
            userData.abilities.memory,
            userData.abilities.cognition,
            userData.analysis.strongest,
            userData.analysis.weakest
          ]]
        })
      }
    );

    if (response.ok) {
      res.status(200).json({ success: true });
    } else {
      res.status(500).json({ success: false, error: 'Failed to save data' });
    }
  } catch (error) {
    res.status(500).json({ success: false, error: 'Server error' });
  }
}
```

**フロントエンド呼び出し:**
```typescript
// クライアントサイド
async function saveUserData(userData: UserData) {
  const response = await fetch('/api/save-data', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userData })
  });

  return response.ok;
}
```

### 8.5 必要な設定手順

**Google Cloud Console設定:**
1. Google Cloud Console でプロジェクト作成
2. Google Sheets API の有効化
3. API キーの生成（HTTP referrers制限推奨）
4. スプレッドシートの作成・公開設定

**Vercel環境変数設定:**
```bash
GOOGLE_API_KEY=your_api_key_here
GOOGLE_SHEET_ID=your_sheet_id_here
```

**プロジェクト構成:**
```
/project-root/
├── app/                    # Next.js App Router
│   ├── page.tsx           # メインページ
│   ├── problem1/page.tsx  # 問題1ページ
│   ├── problem2/page.tsx  # 問題2ページ
│   ├── result/page.tsx    # 結果ページ
│   └── api/
│       └── save-data/
│           └── route.ts   # API Route
├── components/            # 共通コンポーネント
├── lib/                  # ユーティリティ
├── public/
│   └── docs/
│       └── アビリティチェックもんだい１.png
└── types/                # TypeScript型定義
```

**実装準備完了！**